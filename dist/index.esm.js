import{useState as n,useEffect as t,useRef as r,useReducer as e}from"react";import{jsx as o,Fragment as i}from"react/jsx-runtime";var u=function(n){var t=null;return function(r){(t=new BroadcastChannel(n)).onmessage=function(n){var t=n.data,e=t.payload;"STATE_UPDATE"===t.type&&e&&"object"==typeof e&&r.setState(e)};var e=r.subscribe(function(n){!function(n){var r=Object.fromEntries(Object.entries(n).filter(function(n){return"function"!=typeof n[1]}));t&&t.postMessage({type:"STATE_UPDATE",payload:r})}(n)});return function(){t&&t.close(),e()}}},c=function(r){var e=r.children,u=n(!1),c=u[0],f=u[1];return t(function(){f(!0)},[]),/*#__PURE__*/o(i,{children:c?/*#__PURE__*/o("div",{children:e}):null})},f=function(){return function(n){var t=n.getState(),r=n.subscribe(function(n){console.log("Previous State:",t),console.log("New State:",n)});return function(){r()}}},a=function(n,t,r){return function(e){var o=function(){try{if("undefined"!=typeof window){var r=window[n].getItem(t);if(r)return JSON.parse(r)}}catch(n){console.error("Error while loading persisted state:",n)}}();if(e.setState(o||e.getState()),"undefined"!=typeof window)try{return e.subscribe(function(e){!function(e){try{if("undefined"!=typeof window&&window[n]){var o={};r.forEach(function(n){o[n]=e[n]});var i=JSON.stringify(o);window[n].setItem(t,i)}}catch(n){console.error("Error while persisting state:",n)}}(e)})}catch(n){}}};function s(){return s=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=r[e])}return n},s.apply(this,arguments)}var l=function n(t,r){var e=s({},t);for(var o in r)e[o]="object"==typeof r[o]&&null!==r[o]?n(t[o]||{},r[o]):r[o];return e},v=function(n,o){void 0===o&&(o=[]);for(var i=n({}),u=new Set,c=n,f=function(){return void 0===i&&(i=c(null),c=null),i},a=function(n){var t=l(i,n);(function(n,t){if(n===t)return!0;if("object"!=typeof n||null===n||"object"!=typeof t||null===t)return!1;for(var r in n)if(n.hasOwnProperty(r)&&(!t.hasOwnProperty(r)||n[r]!==t[r]))return!1;for(var e in t)if(t.hasOwnProperty(e)&&!n.hasOwnProperty(e))return!1;return!0})(i,t)||(i=t,u.forEach(function(n){return n(i)}))},v=function(n){return u.add(n),function(){u.delete(n)}},p={},d=function(){var n=w[y],t=n[1];"function"==typeof t&&(p[n[0]]=function(){var n=t.apply(void 0,[].slice.call(arguments))(i);a(n)})},y=0,w=Object.entries(n(i));y<w.length;y++)d();return o.forEach(function(n){return n({getState:f,setState:a,subscribe:v})}),function(n){void 0===n&&(n=f);var o=r(n(i)),u=e(function(n){return n+1},0)[1];return t(function(){var t=v(function(t){var r=n(t);o.current!==r&&(o.current=r,u())});return function(){t()}},[n]),s({},o.current,p,{getState:f,setState:a,subscribe:v})}};export{c as HydrateState,u as broadcast,v as createStore,f as logging,a as preserve};
//# sourceMappingURL=index.esm.js.map
