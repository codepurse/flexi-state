{"version":3,"file":"index.cjs","sources":["../src/util/utils.js","../src/index.js"],"sourcesContent":["export const shallowEqual = (objA, objB) => {\r\n  if (objA === objB) return true;\r\n  if (\r\n    typeof objA !== \"object\" ||\r\n    objA === null ||\r\n    typeof objB !== \"object\" ||\r\n    objB === null\r\n  ) {\r\n    return false;\r\n  }\r\n\r\n  for (const key in objA) {\r\n    if (objA.hasOwnProperty(key)) {\r\n      if (!objB.hasOwnProperty(key) || objA[key] !== objB[key]) {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  for (const key in objB) {\r\n    if (objB.hasOwnProperty(key) && !objA.hasOwnProperty(key)) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nexport const deepMerge = (target, source) => {\r\n  const result = { ...target };\r\n  for (const key in source) {\r\n    if (typeof source[key] === \"object\" && source[key] !== null) {\r\n      result[key] = deepMerge(target[key] || {}, source[key]);\r\n    } else {\r\n      result[key] = source[key];\r\n    }\r\n  }\r\n  return result;\r\n};\r\n","import { useEffect, useReducer, useRef } from \"react\";\nimport { deepMerge, shallowEqual } from \"./util/utils\";\n\nexport const createStore = (initializeStore, middlewares = []) => {\n  let state = initializeStore({});\n  let listeners = new Set();\n  let stateInitializer = initializeStore;\n\n  const getState = () => {\n    if (state === undefined) {\n      state = stateInitializer(null);\n      stateInitializer = null;\n    }\n    return state;\n  };\n\n  const setState = (newState) => {\n    const updatedState = deepMerge(state, newState);\n    if (shallowEqual(state, updatedState)) return;\n    state = updatedState;\n    listeners.forEach((listener) => listener(state));\n  };\n\n  const subscribe = (listener) => {\n    listeners.add(listener);\n    return () => {\n      listeners.delete(listener);\n    };\n  };\n\n  const actions = {};\n  for (const [key, action] of Object.entries(initializeStore(state))) {\n    if (typeof action === \"function\") {\n      actions[key] = (...args) => {\n        const updater = action(...args);\n        const newState = updater(state);\n        setState(newState);\n      };\n    }\n  }\n\n  const useStore = (selector = getState) => {\n    const stateRef = useRef(selector(state)); // Initialize with initial state\n    const [_, forceUpdate] = useReducer((x) => x + 1, 0);\n\n    useEffect(() => {\n      const listener = (newState) => {\n        const selectedState = selector(newState);\n        if (stateRef.current !== selectedState) {\n          stateRef.current = selectedState;\n          forceUpdate();\n        }\n      };\n\n      const unsubscribe = subscribe(listener);\n      return () => {\n        unsubscribe();\n      };\n    }, [selector]);\n\n    return {\n      ...stateRef.current,\n      ...actions,\n      getState,\n      setState,\n      subscribe,\n    };\n  };\n\n  // Apply middlewares\n  middlewares.forEach((middleware) =>\n    middleware({ getState, setState, subscribe })\n  );\n\n  return useStore;\n};\n"],"names":["deepMerge","target","source","result","_extends","key","initializeStore","middlewares","state","listeners","Set","stateInitializer","getState","undefined","setState","newState","updatedState","objA","objB","hasOwnProperty","shallowEqual","forEach","listener","subscribe","add","actions","_loop","_Object$entries$_i","_Object$entries","_i","action","apply","slice","call","arguments","updater","Object","entries","length","middleware","selector","stateRef","useRef","forceUpdate","useReducer","x","useEffect","unsubscribe","selectedState","current"],"mappings":"2PAAO,IA4BMA,EAAY,SAAZA,EAAaC,EAAQC,GAChC,IAAMC,EAAMC,EAAQH,GAAAA,GACpB,IAAK,IAAMI,KAAOH,EAEdC,EAAOE,GADkB,iBAAhBH,EAAOG,IAAqC,OAAhBH,EAAOG,GAC9BL,EAAUC,EAAOI,IAAQ,GAAIH,EAAOG,IAEpCH,EAAOG,GAGzB,OAAOF,CACT,sBCnC2B,SAACG,EAAiBC,QAAW,IAAXA,IAAAA,EAAc,IA4BzD,IA3BA,IAAIC,EAAQF,EAAgB,CAAE,GAC1BG,EAAY,IAAIC,IAChBC,EAAmBL,EAEjBM,EAAW,WAKf,YAJcC,IAAVL,IACFA,EAAQG,EAAiB,MACzBA,EAAmB,MAEdH,CACT,EAEMM,EAAW,SAACC,GAChB,IAAMC,EAAehB,EAAUQ,EAAOO,IDjBd,SAACE,EAAMC,GACjC,GAAID,IAASC,EAAM,OAAO,EAC1B,GACkB,iBAATD,GACE,OAATA,GACgB,iBAATC,GACE,OAATA,EAEA,SAGF,IAAK,IAAMb,KAAOY,EAChB,GAAIA,EAAKE,eAAed,MACjBa,EAAKC,eAAed,IAAQY,EAAKZ,KAASa,EAAKb,IAClD,OACF,EAIJ,IAAK,IAAMA,KAAOa,EAChB,GAAIA,EAAKC,eAAed,KAASY,EAAKE,eAAed,GACnD,OACF,EAGF,OAAO,CACT,ECRQe,CAAaZ,EAAOQ,KACxBR,EAAQQ,EACRP,EAAUY,QAAQ,SAACC,GAAa,OAAAA,EAASd,EAAM,GACjD,EAEMe,EAAY,SAACD,GAEjB,OADAb,EAAUe,IAAIF,GACD,WACXb,EAAS,OAAQa,EACnB,CACF,EAEMG,EAAU,CAAA,EAAGC,EAAA,WACd,IAAAC,EAAAC,EAAAC,GAAYC,EAAMH,EACrB,GAAsB,mBAAXG,IACTL,EAFWE,EAAA,IAEI,WACb,IACMZ,EADUe,EAAMC,WAAAC,EAAAA,GAAAA,MAAAC,KAAAC,WACLC,CAAQ3B,GACzBM,EAASC,EACX,EAEJ,EARAc,EAAAD,EAAAA,EAA4BQ,OAAOC,QAAQ/B,EAAgBE,IAAOqB,EAAAD,EAAAU,OAAAT,IAAAH,IA2ClE,OAJAnB,EAAYc,QAAQ,SAACkB,GAAU,OAC7BA,EAAW,CAAE3B,SAAAA,EAAUE,SAAAA,EAAUS,UAAAA,GAAY,GA9B9B,SAACiB,QAAAA,IAAAA,IAAAA,EAAW5B,GAC3B,IAAM6B,EAAWC,EAAMA,OAACF,EAAShC,IACvBmC,EAAeC,EAAUA,WAAC,SAACC,GAAM,OAAAA,EAAI,CAAC,EAAE,GAElDC,GAeA,OAfAA,EAASA,UAAC,WACR,IAQMC,EAAcxB,EARH,SAACR,GAChB,IAAMiC,EAAgBR,EAASzB,GAC3B0B,EAASQ,UAAYD,IACvBP,EAASQ,QAAUD,EACnBL,IAEJ,GAGA,OAAO,WACLI,GACF,CACF,EAAG,CAACP,IAEJpC,EACKqC,GAAAA,EAASQ,QACTxB,EAAO,CACVb,SAAAA,EACAE,SAAAA,EACAS,UAAAA,GAEJ,CAQF"}