{"version":3,"file":"index.umd.js","sources":["../src/util/utils.js","../src/middleware/hydrateState.js","../src/middleware/broadcast.js","../src/createStore.js","../src/middleware/logging.js","../src/middleware/preserve.js"],"sourcesContent":["export const shallowEqual = (objA, objB) => {\r\n  if (objA === objB) return true;\r\n  if (\r\n    typeof objA !== \"object\" ||\r\n    objA === null ||\r\n    typeof objB !== \"object\" ||\r\n    objB === null\r\n  ) {\r\n    return false;\r\n  }\r\n\r\n  for (const key in objA) {\r\n    if (objA.hasOwnProperty(key)) {\r\n      if (!objB.hasOwnProperty(key) || objA[key] !== objB[key]) {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  for (const key in objB) {\r\n    if (objB.hasOwnProperty(key) && !objA.hasOwnProperty(key)) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nexport const deepMerge = (target, source) => {\r\n  const result = { ...target };\r\n  for (const key in source) {\r\n    if (typeof source[key] === \"object\" && source[key] !== null) {\r\n      result[key] = deepMerge(target[key] || {}, source[key]);\r\n    } else {\r\n      result[key] = source[key];\r\n    }\r\n  }\r\n  return result;\r\n};\r\n","import { useEffect, useState } from \"react\";\r\n\r\nexport const HydrateState = ({ children }) => {\r\n  const [isHydrated, setIsHydrated] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setIsHydrated(true);\r\n  }, []);\r\n\r\n  return <>{isHydrated ? <div>{children}</div> : null}</>;\r\n};\r\n","export const broadcast = (broadcastKey) => {\r\n  let broadcastChannel = null;\r\n\r\n  return (store) => {\r\n    const handleBroadcastMessage = (event) => {\r\n      const { type, payload } = event.data;\r\n      if (type === \"STATE_UPDATE\" && payload && typeof payload === \"object\") {\r\n        store.setState(payload);\r\n      }\r\n    };\r\n\r\n    const initializeBroadcastChannel = () => {\r\n      broadcastChannel = new BroadcastChannel(broadcastKey);\r\n      broadcastChannel.onmessage = handleBroadcastMessage;\r\n    };\r\n\r\n    const sendStateUpdate = (state) => {\r\n      // Omit any functions from the state before broadcasting\r\n      const stateToSend = Object.fromEntries(\r\n        Object.entries(state).filter(([, value]) => typeof value !== \"function\")\r\n      );\r\n\r\n      if (broadcastChannel) {\r\n        broadcastChannel.postMessage({\r\n          type: \"STATE_UPDATE\",\r\n          payload: stateToSend,\r\n        });\r\n      }\r\n    };\r\n\r\n    // Initialize broadcast channel\r\n    initializeBroadcastChannel();\r\n\r\n    // Subscribe to state changes and broadcast updates\r\n    const unsubscribe = store.subscribe((state) => {\r\n      sendStateUpdate(state);\r\n    });\r\n\r\n    // Return unsubscribe function to clean up on unmount\r\n    return () => {\r\n      if (broadcastChannel) {\r\n        broadcastChannel.close();\r\n      }\r\n      unsubscribe();\r\n    };\r\n  };\r\n};\r\n","import { useEffect, useReducer, useRef } from \"react\";\r\nimport { deepMerge, shallowEqual } from \"./util/utils\";\r\n\r\nexport const createStore = (initializeStore, middlewares = []) => {\r\n  let state = initializeStore({});\r\n  let listeners = new Set();\r\n  let stateInitializer = initializeStore;\r\n\r\n  const getState = () => {\r\n    if (state === undefined) {\r\n      state = stateInitializer(null);\r\n      stateInitializer = null;\r\n    }\r\n    return state;\r\n  };\r\n\r\n  const setState = (newState) => {\r\n    const updatedState = deepMerge(state, newState);\r\n    if (shallowEqual(state, updatedState)) return;\r\n    state = updatedState;\r\n    listeners.forEach((listener) => listener(state));\r\n  };\r\n\r\n  const subscribe = (listener) => {\r\n    listeners.add(listener);\r\n    return () => {\r\n      listeners.delete(listener);\r\n    };\r\n  };\r\n\r\n  const actions = {};\r\n  for (const [key, action] of Object.entries(initializeStore(state))) {\r\n    if (typeof action === \"function\") {\r\n      actions[key] = (...args) => {\r\n        const updater = action(...args);\r\n        const newState = updater(state);\r\n        setState(newState);\r\n      };\r\n    }\r\n  }\r\n\r\n  const useStore = (selector = getState) => {\r\n    const stateRef = useRef(selector(state)); // Initialize with initial state\r\n    const [_, forceUpdate] = useReducer((x) => x + 1, 0);\r\n\r\n    useEffect(() => {\r\n      const listener = (newState) => {\r\n        const selectedState = selector(newState);\r\n        if (stateRef.current !== selectedState) {\r\n          stateRef.current = selectedState;\r\n          forceUpdate();\r\n        }\r\n      };\r\n\r\n      const unsubscribe = subscribe(listener);\r\n      return () => {\r\n        unsubscribe();\r\n      };\r\n    }, [selector]);\r\n\r\n    return {\r\n      ...stateRef.current,\r\n      ...actions,\r\n      getState,\r\n      setState,\r\n      subscribe,\r\n    };\r\n  };\r\n\r\n  // Apply middlewares\r\n  middlewares.forEach((middleware) =>\r\n    middleware({ getState, setState, subscribe })\r\n  );\r\n\r\n  return useStore;\r\n};\r\n","export const logging = () => {\r\n  return (store) => {\r\n    let prevState = store.getState(); // Initialize previous state\r\n\r\n    // Subscribe to state changes and log them\r\n    const unsubscribe = store.subscribe((newState) => {\r\n      console.log(\"Previous State:\", prevState);\r\n      console.log(\"New State:\", newState);\r\n    });\r\n\r\n    // Return unsubscribe function to clean up on unmount\r\n    return () => {\r\n      unsubscribe();\r\n    };\r\n  };\r\n};\r\n","export const preserve = (storageType, storageName, stateKeys) => {\r\n  return (store) => {\r\n    const persistState = (state) => {\r\n      try {\r\n        if (typeof window !== \"undefined\" && window[storageType]) {\r\n          const persistedState = {};\r\n          stateKeys.forEach((key) => {\r\n            persistedState[key] = state[key];\r\n          });\r\n          const serializedState = JSON.stringify(persistedState);\r\n          window[storageType].setItem(storageName, serializedState);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error while persisting state:\", error);\r\n      }\r\n    };\r\n\r\n    const loadState = () => {\r\n      try {\r\n        if (typeof window !== \"undefined\") {\r\n          const persistedState = window[storageType].getItem(storageName);\r\n          if (persistedState) {\r\n            return JSON.parse(persistedState);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error while loading persisted state:\", error);\r\n      }\r\n      return undefined;\r\n    };\r\n\r\n    // Load persisted state on initialization\r\n    const initialState = loadState();\r\n    if (initialState) {\r\n      store.setState(initialState);\r\n    } else {\r\n      // Use the initial state from the initializeStore function\r\n      store.setState(store.getState());\r\n    }\r\n\r\n    // Subscribe to state changes and persist selected state slices\r\n\r\n    if (typeof window !== \"undefined\") {\r\n      try {\r\n        const unsubscribe = store.subscribe((state) => {\r\n          persistState(state);\r\n        });\r\n\r\n        // Return unsubscribe function to clean up on unmount\r\n        return unsubscribe;\r\n      } catch (error) {}\r\n    }\r\n  };\r\n};\r\n"],"names":["deepMerge","target","source","result","_extends","key","_ref","children","_useState","useState","isHydrated","setIsHydrated","useEffect","_jsx","_Fragment","Fragment","jsx","broadcastKey","broadcastChannel","store","BroadcastChannel","onmessage","event","_event$data","data","payload","type","setState","unsubscribe","subscribe","state","stateToSend","Object","fromEntries","entries","filter","postMessage","sendStateUpdate","close","initializeStore","middlewares","listeners","Set","stateInitializer","getState","undefined","newState","updatedState","objA","objB","hasOwnProperty","shallowEqual","forEach","listener","add","actions","_loop","_Object$entries$_i","_Object$entries","_i","action","apply","slice","call","arguments","updater","length","middleware","selector","stateRef","useRef","forceUpdate","useReducer","x","selectedState","current","prevState","console","log","storageType","storageName","stateKeys","initialState","window","persistedState","getItem","JSON","parse","error","loadState","serializedState","stringify","setItem","persistState"],"mappings":"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"}