{"version":3,"file":"index.esm.js","sources":["../src/index.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\n\r\nexport const createStore = (initializeStore, middleware = (store) => store) => {\r\n  let state = initializeStore(null);\r\n  let listeners = new Set();\r\n  let stateInitializer = initializeStore;\r\n\r\n  const getState = () => {\r\n    if (state === undefined) {\r\n      state = stateInitializer(null);\r\n      stateInitializer = null;\r\n    }\r\n    return state;\r\n  };\r\n\r\n  const setState = (newState) => {\r\n    const updatedState = deepMerge(state, newState);\r\n    if (shallowEqual(state, updatedState)) return;\r\n    state = updatedState;\r\n    listeners.forEach((listener) => listener(state));\r\n  };\r\n\r\n  const subscribe = (listener) => {\r\n    listeners.add(listener);\r\n    return () => {\r\n      listeners.delete(listener);\r\n    };\r\n  };\r\n\r\n  const actions = {};\r\n  for (const [key, action] of Object.entries(initializeStore(state))) {\r\n    if (typeof action === \"function\") {\r\n      actions[key] = (...args) => {\r\n        const updater = action(...args);\r\n        const newState = updater(state);\r\n        setState(newState);\r\n      };\r\n    }\r\n  }\r\n\r\n  return (selector = getState) => {\r\n    const [currentState, setCurrentState] = useState(selector(getState()));\r\n\r\n    useEffect(() => {\r\n      const listener = (newState) => {\r\n        const selectedState = selector(newState);\r\n        if (!shallowEqual(currentState, selectedState)) {\r\n          // Update state only if it has changed\r\n          setCurrentState(selectedState);\r\n        }\r\n      };\r\n\r\n      const unsubscribe = subscribe(listener);\r\n\r\n      // Clean up subscription\r\n      return () => {\r\n        unsubscribe();\r\n      };\r\n    }, [selector]);\r\n\r\n    return { ...currentState, ...actions, getState, setState, subscribe };\r\n  };\r\n};\r\n\r\nconst shallowEqual = (objA, objB) => {\r\n  if (objA === objB) return true;\r\n  if (\r\n    typeof objA !== \"object\" ||\r\n    objA === null ||\r\n    typeof objB !== \"object\" ||\r\n    objB === null\r\n  ) {\r\n    return false;\r\n  }\r\n\r\n  for (const key in objA) {\r\n    if (objA.hasOwnProperty(key)) {\r\n      if (!objB.hasOwnProperty(key) || objA[key] !== objB[key]) {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  for (const key in objB) {\r\n    if (objB.hasOwnProperty(key) && !objA.hasOwnProperty(key)) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nconst deepMerge = (target, source) => {\r\n  const result = { ...target };\r\n  for (const key in source) {\r\n    if (typeof source[key] === \"object\" && source[key] !== null) {\r\n      result[key] = deepMerge(target[key] || {}, source[key]);\r\n    } else {\r\n      result[key] = source[key];\r\n    }\r\n  }\r\n  return result;\r\n};\r\n"],"names":["createStore","initializeStore","middleware","state","listeners","Set","stateInitializer","getState","undefined","setState","newState","updatedState","deepMerge","shallowEqual","forEach","listener","subscribe","add","actions","_loop","_Object$entries$_i","_Object$entries","_i","action","apply","slice","call","arguments","updater","Object","entries","length","selector","_useState","useState","currentState","setCurrentState","useEffect","unsubscribe","selectedState","_extends","objA","objB","key","hasOwnProperty","target","source","result"],"mappings":"oRAEa,IAAAA,EAAc,SAACC,EAAiBC,GA4B3C,IA3BA,IAAIC,EAAQF,EAAgB,MACxBG,EAAY,IAAIC,IAChBC,EAAmBL,EAEjBM,EAAW,WAKf,YAJcC,IAAVL,IACFA,EAAQG,EAAiB,MACzBA,EAAmB,MAEdH,CACT,EAEMM,EAAW,SAACC,GAChB,IAAMC,EAAeC,EAAUT,EAAOO,GAClCG,EAAaV,EAAOQ,KACxBR,EAAQQ,EACRP,EAAUU,QAAQ,SAACC,GAAQ,OAAKA,EAASZ,EAAM,GACjD,EAEMa,EAAY,SAACD,GAEjB,OADAX,EAAUa,IAAIF,GACP,WACLX,EAAgB,OAACW,EACnB,CACF,EAEMG,EAAU,GAAGC,EAAAA,WACd,IAAAC,EAAAC,EAAAC,GAAYC,EAAMH,EAAA,GACC,mBAAXG,IACTL,EAFWE,EAAEG,IAEE,WACb,IACMb,EADUa,EAAMC,WAAA,EAAA,GAAAC,MAAAC,KAAAC,WACLC,CAAQzB,GACzBM,EAASC,EACX,EAEJ,EARAY,EAAAD,EAAAA,EAA4BQ,OAAOC,QAAQ7B,EAAgBE,IAAOmB,EAAAD,EAAAU,OAAAT,IAAAH,IAUlE,OAAQa,SAAAA,QAAAA,IAAAA,IAAAA,EAAWzB,GACjB,IAAA0B,EAAwCC,EAASF,EAASzB,MAAnD4B,EAAYF,KAAEG,EAAeH,EAAA,GAmBpC,OAjBAI,EAAU,WACR,IAQMC,EAActB,EARH,SAACN,GAChB,IAAM6B,EAAgBP,EAAStB,GAC1BG,EAAasB,EAAcI,IAE9BH,EAAgBG,EAEpB,GAKA,OAAa,WACXD,GACF,CACF,EAAG,CAACN,IAEJQ,EAAA,GAAYL,EAAiBjB,EAASX,CAAAA,SAAAA,EAAUE,SAAAA,EAAUO,UAAAA,GAC5D,CACF,EAEMH,EAAe,SAAC4B,EAAMC,GAC1B,GAAID,IAASC,EAAM,OAAO,EAC1B,GACkB,iBAATD,GACE,OAATA,GACgB,iBAATC,GACE,OAATA,EAEA,OACF,EAEA,IAAK,IAAMC,KAAOF,EAChB,GAAIA,EAAKG,eAAeD,MACjBD,EAAKE,eAAeD,IAAQF,EAAKE,KAASD,EAAKC,IAClD,SAKN,IAAK,IAAMA,KAAOD,EAChB,GAAIA,EAAKE,eAAeD,KAASF,EAAKG,eAAeD,GACnD,OAAO,EAIX,OAAO,CACT,EAEM/B,EAAY,SAAZA,EAAaiC,EAAQC,GACzB,IAAMC,EAAMP,EAAA,GAAQK,GACpB,IAAK,IAAMF,KAAOG,EAEdC,EAAOJ,GADkB,iBAAhBG,EAAOH,IAAqC,OAAhBG,EAAOH,GAC9B/B,EAAUiC,EAAOF,IAAQ,CAAE,EAAEG,EAAOH,IAEpCG,EAAOH,GAGzB,OAAOI,CACT"}